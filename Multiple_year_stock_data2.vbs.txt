Sub StockMarket_Analysis()    Dim ws As Worksheet    Dim Ticker As String    Dim year_open As Double    Dim year_close As Double    Dim Yearly_Change As Double    Dim Total_Stock_Volume As Double    Dim Percent_Change As Double    Dim start_data As Long    Dim previous_i As Long    Dim EndRow As Long    Dim Increase As Double    Dim Decrease As Double    Dim Greatest As Double    Dim increase_name As String    Dim decrease_name As String    Dim greatest_name As String    Dim kEndRow As Long    Dim jEndRow As Long    Dim i As Long, j As Long, k As Long    Dim last_k As Long    Dim current_k As Double    Dim previous_k As Double    Dim volume As Double    Dim previous_vol As Double    For Each ws In ThisWorkbook.Worksheets        With ws            ' Clear previous results if any            .Range("I:L").ClearContents            .Range("N:O").ClearContents            .Range("P:P").ClearFormats                        ' Assign column headers            .Range("I1").Value = "Ticker"            .Range("J1").Value = "Yearly Change"            .Range("K1").Value = "Percent Change"            .Range("L1").Value = "Total Stock Volume"                        ' Initialize variables            start_data = 2            previous_i = 1            Total_Stock_Volume = 0            Increase = 0            Decrease = 0            Greatest = 0                        EndRow = .Cells(.Rows.Count, "A").End(xlUp).Row            For i = 2 To EndRow                If .Cells(i + 1, 1).Value <> .Cells(i, 1).Value Then                    Ticker = .Cells(i, 1).Value                    previous_i = previous_i + 1                    year_open = .Cells(previous_i, 3).Value                    year_close = .Cells(i, 6).Value                    For j = previous_i To i                        Total_Stock_Volume = Total_Stock_Volume + .Cells(j, 7).Value                    Next j                    If year_open = 0 Then                        Percent_Change = year_close                    Else                        Yearly_Change = year_close - year_open                        Percent_Change = Yearly_Change / year_open                    End If                    .Cells(start_data, 9).Value = Ticker                    .Cells(start_data, 10).Value = Yearly_Change                    .Cells(start_data, 11).Value = Percent_Change                    .Cells(start_data, 11).NumberFormat = "0.00%"                    .Cells(start_data, 12).Value = Total_Stock_Volume                    start_data = start_data + 1                    Total_Stock_Volume = 0                    Yearly_Change = 0                    Percent_Change = 0                    previous_i = i                End If            Next i            ' Second summary table            kEndRow = .Cells(.Rows.Count, "K").End(xlUp).Row            For k = 3 To kEndRow                last_k = k - 1                current_k = .Cells(k, 11).Value                previous_k = .Cells(last_k, 11).Value                volume = .Cells(k, 12).Value                previous_vol = .Cells(last_k, 12).Value                                ' Find the increase                If current_k > Increase Then                    Increase = current_k                    increase_name = .Cells(k, 9).Value                End If                                ' Find the decrease                If current_k < Decrease Then                    Decrease = current_k                    decrease_name = .Cells(k, 9).Value                End If                                ' Find the greatest volume                If volume > Greatest Then                    Greatest = volume                    greatest_name = .Cells(k, 9).Value                End If            Next k            ' Assign names for greatest increase, greatest decrease, and greatest volume            .Range("N1").Value = "Column Name"            .Range("N2").Value = "Greatest % Increase"            .Range("N3").Value = "Greatest % Decrease"            .Range("N4").Value = "Greatest Total Volume"            .Range("O1").Value = "Ticker Name"            .Range("P1").Value = "Value"            .Range("O2").Value = increase_name            .Range("O3").Value = decrease_name            .Range("O4").Value = greatest_name            .Range("P2").Value = Increase            .Range("P3").Value = Decrease            .Range("P4").Value = Greatest            .Range("P2:P3").NumberFormat = "0.00%"            ' Conditional formatting for percent change            jEndRow = .Cells(.Rows.Count, "J").End(xlUp).Row            For j = 2 To jEndRow                If .Cells(j, 10) > 0 Then                    .Cells(j, 10).Interior.ColorIndex = 4                Else                    .Cells(j, 10).Interior.ColorIndex = 3                End If            Next j        End With    Next wsEnd Sub